<!DOCTYPE html>
<html>
    <title>zHekBot - Two vs Two</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
    * {
        box-sizing: border-box;
        margin: 0;
        font-family: Arial;
    }
    
    .navbar {
        position: fixed;
        top: 0;
        width: 100vw;
        max-height: 5vh;
        padding: 0vh 1vw;
        margin: 0;
        background-color: green;
        color: white;
        display: flex;
        justify-content: space-between;
    }
    
    .content {
        max-width: 100%;
        background: white;
        padding: 25px;
        margin-top: 60px;
        text-align: center;
    }
    
    .footer {
        position: fixed;
        bottom: 0;
        width: 100vw;
        max-height: fit-content;
        background-color: green;
        color: white;
        text-align: center;
        padding: 1vh 1vw;
        font-size: auto;
    }  

    button {
        padding: 0.2vh 0.3vw;
        text-align: center;
    }

    .content > div {
        padding: 0.2vh 0.3vw;
    }

    .change {
        width: 25px;
        height: 25px;
    }

    #twitch {
        background-color: #9146ff;
        border-radius: 10px;
    }

    span {
        font-size:18px;
        width: 18px;
        text-align: center;
        display: inline-block;
    }

img { 
  max-height: 5vh;
  width: auto; 
}
    
    </style>
    <body>
        <div class="navbar">
            <a href="/"><img href="/" src="/images/Logo.png" style="float: left; padding-right: 0.3vw; cursor: pointer;"><button style="background: green; border: none; font-size: 3.25vh; padding-top: 0.5vh; color: white; cursor: pointer;">zHekBot</button></a>
            <a href="/login" id="twitch" style="padding: 0vh 0.35vw;">
                <img src="/images/Twitch.png" style="float: left; padding: 0.4vh 0vw;">
                <button style="border: none; font-size: 2.65vh; color: white; background-color: #9146ff; cursor: pointer; padding-top: 0.7vh;">Logout of Twitch</button>
            </a>
        </div>

    <div class="content">
        <h1>#Placeholder#'s 2v2 Counter</h1>
        <div>&emsp;&emsp;
            <button id="send" onclick="sendScore()">Send Scores</button>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
            Respond to !score
        </div>
        <div>
            <input id='hName' type="text" readonly="true" value="#channel#" size="8" style="text-align:center;">
            Kills: 
            <button class="change" onclick="add('hKills')">+</button> 
            <span id="hKills">0</span> 
            <button class="change" onclick="sub('hKills')">-</button>&ensp;
            <input type="checkbox" id="hStatus" class="hName" onclick="upStatus('hName')">&ensp;
            <label for="hStatus">Enabled</label>
        </div>
        <div>
            <input type="text" id="tName" placeholder="Teammate" size="8" style="text-align:center;"> 
            Kills: 
            <button class="change" onclick="add('tKills')">+</button> 
            <span id="tKills">0</span> 
            <button class="change" onclick="sub('tKills')">-</button>&ensp;
            <input type="checkbox" id="tStatus" class="tName" onclick="upStatus('tName')">&ensp;
            <label for="tStatus">Enabled</label>
        </div>
        <div>
            <input type="text" id="o1Name" placeholder="Opponent 1" size="8" style="text-align:center;">
            Kills: 
            <button class="change" onclick="add('o1Kills')">+</button> 
            <span id="o1Kills">0</span> 
            <button class="change" onclick="sub('o1Kills')">-</button>&ensp;
            <input type="checkbox" id="o1Status" class="o1Name" onclick="upStatus('o1Name')">&ensp;
            <label for="o1Status">Enabled</label>
        </div>
        <div><input type="text" id="o2Name" placeholder="Opponent 2" size="8" style="text-align:center;">
            Kills: 
            <button class="change" onclick="add('o2Kills')">+</button> 
            <span id="o2Kills">0</span> 
            <button class="change" onclick="sub('o2Kills')">-</button>&ensp;
            <input type="checkbox" id="o2Status" class="o2Name" onclick="upStatus('o2Name')">&ensp;
            <label for="o2Status">Enabled</label>
        </div><br>
        <div><button onclick="reset()">Reset All</button></div>
        <div>
            Map Reset (carry scores over): 
            <button class="change" onclick="mapreset(1)">+</button> 
            <button class="change" onclick="mapreset(0)" style="text-align: center; width: 45px;">Zero</button>
            <button class="change" onclick="mapreset(-1)">-</button>
            <span id="updown" style="display: inline-block; font-size: auto; width: 75px;">-</span> 
        </div>
        <br><br>
        <div>Clicking the 'Send Scores' button will update the current scores and put them in chat.</div>
        <div>If you have the box beside a stream checked, the bot will respond to !score when it is typed in the chat.</div>
        <div>Note that the name provided must be the Twitch stream (and you must have permissions for that stream).</div>
        <br>
        <div>If the map is reset but the current scores will carry over, you can enter this in the appropriate input and it will be accounted for.</div>
    </div>

    <footer class="footer">Any questions / issues / suggestions? The best way to contact me is on Twitch (zHekLeR) or Discord (zHekLeR#4857).</footer>

    <script>
        let resetvalue = 0;

        (function first() {
            let channel = document.getElementById('hName').value;
            fetch(`/twovtwoscores/${channel.toLowerCase()}`, {
                method: "GET"
            }).then(res => res.text())
            .then(body => {
                scores = body.split(',');
                console.log(body);
                if (scores.length == 12) {
                    document.getElementById('hKills').innerHTML = parseInt(scores[0]);
                    document.getElementById('tKills').innerHTML = parseInt(scores[1]);
                    document.getElementById('o1Kills').innerHTML = parseInt(scores[2]);
                    document.getElementById('o2Kills').innerHTML = parseInt(scores[3]);
                    document.getElementById('tName').value = scores[4];
                    document.getElementById('o1Name').value = scores[5];
                    document.getElementById('o2Name').value = scores[6];
                    document.getElementById('hStatus').checked = scores[7] === 'true';
                    document.getElementById('tStatus').checked = scores[8] === 'true';
                    document.getElementById('o1Status').checked = scores[9] === 'true';
                    document.getElementById('o2Status').checked = scores[10] === 'true';
                    resetvalue = parseInt(scores[11]);
                    document.getElementById('updown').innerHTML = (resetvalue > 0?'Up':resetvalue < 0?'Down':'') + ` ${Math.abs(resetvalue)}`;
                } 
                console.log('Success during first.');
            }).catch(err => {
                console.log(`Error during first: ${err}`);
            })
        })();

        async function upStatus(setStat) {
            let elem = document.getElementsByClassName(`${setStat}`)[0];
            if (document.getElementById(setStat).value.length == 0) { 
                elem.checked = !elem.checked;
                return;
            }
            elem.disabled = true;
            setTimeout(function () { elem.disabled = false; }, 2000)
            await fetch(`/post/${document.getElementById(setStat).value.toLowerCase()}/enable`, {
                headers: {
                    enabled: elem.checked
                }
            })
            .then(resp => {
                if (resp.status !== 200) {
                    elem.checked = !elem.checked;
                } 
            })
            .catch(err => {
                console.log(err);
            });
        }

        function sendScore() {
            try {
                document.getElementById("send").disabled = true;
                setTimeout(function() {document.getElementById("send").disabled = false;}, 1000);
                fetch(`/send/${document.getElementById('hName').value.toLowerCase()}/${document.getElementById('hKills').innerHTML}/${document.getElementById('tKills').innerHTML}/${document.getElementById('o1Kills').innerHTML}/${document.getElementById('o2Kills').innerHTML}`, {
                    method: "GET",
                    headers: {
                        tname: document.getElementById('tName').value.toLowerCase(),
                        o1name: document.getElementById('o1Name').value.toLowerCase(),
                        o2name: document.getElementById('o2Name').value.toLowerCase(),
                        mapreset: resetvalue
                    }
                });
                console.log('2v2 send success.');
            } catch (err) {
                if (sInt) {
                    clearInterval(sInt);
                }
                console.log(`Error during send function: ${err}`);
            }
        }

        function add(id) {
            document.getElementById(id).innerHTML = parseInt(document.getElementById(id).innerHTML) + 1;
        }

        function sub(id) {
            let x = document.getElementById(id);
            x.innerHTML = parseInt(x.innerHTML)==0?0:parseInt(x.innerHTML) - 1;
        }

        function reset() {
            try {
                fetch(`/post/${document.getElementById('hName').value.toLowerCase()}/reset`, {
                    method: "GET",
                    headers: {
                        tname: document.getElementById('tName').value.toLowerCase(),
                        o1name: document.getElementById('o1Name').value.toLowerCase(),
                        o2name: document.getElementById('o2Name').value.toLowerCase()
                    }
                }).then(res => {
                    console.log('2v2 reset success.');
                    document.getElementById('hKills').innerHTML = 0;
                    document.getElementById('tKills').innerHTML = 0;
                    document.getElementById('o1Kills').innerHTML = 0;
                    document.getElementById('o2Kills').innerHTML = 0;
                }).catch(err => {
                    console.log('2v2 reset failed.');
                });
            } catch (err) {
                console.log(`Error during 2v2 reset: ${err}`);
            }
        }

        function mapreset(change) {
            resetvalue = change == 0?0:resetvalue + change;
            document.getElementById('updown').innerHTML = (resetvalue > 0?'Up':resetvalue < 0?'Down':'') + ` ${Math.abs(resetvalue)}`;
        }
    </script>

</body>
</html>